(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     66065,       1672]
NotebookOptionsPosition[     62338,       1549]
NotebookOutlinePosition[     62800,       1567]
CellTagsIndexPosition[     62757,       1564]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Preamble", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.568030133381249*^9, 3.568030135409299*^9}}],

Cell[BoxData[
 RowBox[{"BeginPackage", "[", "\"\<Cosmology`\>\"", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536233877621356*^9, 3.536233891728385*^9}, {
   3.536234273302287*^9, 3.536234273653772*^9}, 3.53623557061391*^9, 
   3.536237860612636*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"$location", "=", 
   RowBox[{"DirectoryName", "[", "$InputFileName", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.568109621628337*^9, 3.56810964925616*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cosmology", "::", "usage"}], "=", 
  "\"\<This list of rules defines the background cosmology.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536233899004134*^9, 3.536233935683492*^9}, {
   3.536233991839672*^9, 3.536234003631472*^9}, 3.536235572203676*^9, {
   3.536236795444606*^9, 3.536236796172723*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetCosmology", "::", "usage"}], "=", 
  "\"\<Modify the fiducial cosmology by passing the new options to this \
function.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5558284592119217`*^9, 3.555828487653924*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Fiducial", "::", "usage"}], "=", 
  "\"\<Fiducial[X] returns the fiducial value of parameter X.\>\""}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.536234705692961*^9, 3.536234724096031*^9}, 
   3.536235573315504*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Redshift", "::", "usage"}], "=", 
  "\"\<Redshift[a] returns the redshift as a function of the scale factor, \
i.e. z=1/a+1.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536235366111039*^9, 3.536235395943888*^9}, 
   3.536235576120499*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Hubble", "::", "usage"}], "=", 
  "\"\<Hubble[z] returns the Hubble parameter at a given redshift z.\>\""}]], \
"Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536234009393193*^9, 3.536234014269308*^9}, {
   3.536234230146321*^9, 3.536234260334134*^9}, 3.53623484977609*^9, 
   3.536235577788491*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ScaleFactor", "::", "usage"}], "=", 
  "\"\<ScaleFactor[t] returns a at cosmic time t.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5553933023643703`*^9, 3.555393330182784*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DimensionlessHubble", "::", "usage"}], "=", 
  "\"\<DimensionlessHubble[z] returns the Hubble parameter at a given \
redshift z divided by the Hubble constant today.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.53623473537198*^9, 3.536234770361063*^9}, 
   3.536234851158523*^9, 3.536235582009899*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"w", "::", "usage"}], "=", 
  "\"\<w[z] returns the equation of state at redshift z using the CPL \
parameterization.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536234837672355*^9, 3.536234863485673*^9}, {
   3.536234951993064*^9, 3.536234958355009*^9}, 3.536235582813306*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GrowthFunction", "::", "usage"}], "=", 
  "\"\<GrowthFunction[z] returns the growth function at redshift z, \
parameterized by the growth index.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536235245464745*^9, 3.536235289959094*^9}, 
   3.536235589097846*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GrowthFactor", "::", "usage"}], "=", 
  "\"\<GrowthFactor[z] returns the growth factor at redshift z, parameterized \
by the growth index.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536235297749865*^9, 3.536235303805108*^9}, 
   3.536235590595226*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"OmegaM", "::", "usage"}], "=", 
  "\"\<OmegaM[z] returns the relative matter density at redshift z.\>\""}]], \
"Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536234974229402*^9, 3.53623499705642*^9}, 
   3.53623559323801*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Distance", "::", "usage"}], "=", 
  "\"\<Distance[z] accepts the Option DistanceType with the possible values \
Comoving, TransverseComoving, AngularDiameter, Luminosity or LookBack. \
Distance[z1, z2] gives the distance between two galaxies at redshifts z1 and \
z2 along the line of sight.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536235099468355*^9, 3.536235216138243*^9}, 
   3.536235595808799*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TransferFunction", "::", "usage"}], "=", 
  "\"\<TransferFunction[k,path] returns a list of five values using the \
fitting formulae by Eisenstein&Hu(1999). The values are: The full transfer \
function, the baryon transfer function, the CDM transfer function, the \
no-wiggles transfer function, and the no-baryon transfer function. The path \
to the MathLink executable needs to be passed by path.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.555149950572431*^9, 3.555149975999014*^9}, {
   3.5551506843049393`*^9, 3.5551507004062033`*^9}, {3.5551512766862392`*^9, 
   3.555151302442206*^9}, {3.5551515933344297`*^9, 3.5551516282482452`*^9}, {
   3.555154166891384*^9, 3.555154188358317*^9}, 3.555222745935821*^9, {
   3.555222797417832*^9, 3.5552227997421*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LinearPS", "::", "usage"}], "=", 
  "\"\<LinearPS[k,z,path] returns a list of five values using the fitting \
formulae by Eisenstein&Hu(1999). The values are: The full linear power \
spectrum, the baryon power spectrum, the CDM power spectrum, the no-wiggles \
power spectrum, and the no-baryon power spectrum.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5551515726875*^9, 3.5551516009884567`*^9}, {
   3.55515163544554*^9, 3.55515165904941*^9}, {3.555154136546392*^9, 
   3.555154163381996*^9}, 3.5552227448005857`*^9, 3.5552228024684687`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PowerSpectrum", "::", "usage"}], "=", 
  "\"\<PowerSpectrum[k,z] returns the power spectrum at wavenumber k and \
redshift z. The algorithm can be specified with PSType.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.568098655102173*^9, 3.56809869811411*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"NonlinearPowerSpectrum", "::", "usage"}], "=", 
  "\"\<NonlinearPowerSpectrum[k,z,Omega21,Omega22] returns the power spectrum \
at wavenumber k and redshift z using the background functions Omega21 and \
Omega22 as specified by the TRG package.\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.568098655102173*^9, 3.56809869811411*^9}, {
  3.5697389238169003`*^9, 3.569738960110395*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Options", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"OmegaB", "::", "usage"}], "=", "\"\<Baryon density\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OmegaC", "::", "usage"}], "=", 
    "\"\<Cold dark matter density\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OmegaL", "::", "usage"}], "=", "\"\<Dark energy density\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OmegaTot", "::", "usage"}], "=", "\"\<Total density\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OmegaK", "::", "usage"}], "=", "\"\<Curvature 'density'\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"h", "::", "usage"}], "=", "\"\<Reduced Hubble parameter\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"H0", "::", "usage"}], "=", "\"\<Hubble parameter\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaM", "::", "usage"}], "=", 
    "\"\<Reduced matter density\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaL", "::", "usage"}], "=", 
    "\"\<Reduced dark energy density\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaB", "::", "usage"}], "=", 
    "\"\<Reduced baryon density\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaC", "::", "usage"}], "=", 
    "\"\<Reduced cold dark matter density\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaK", "::", "usage"}], "=", 
    "\"\<Reduced curvature 'density'\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"w0", "::", "usage"}], "=", "\"\<Equation of state today\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"w1", "::", "usage"}], "=", 
    "\"\<Equation of state running parameter\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gamma", "::", "usage"}], "=", "\"\<Growth index\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigma8", "::", "usage"}], "=", 
    "\"\<Power spectrum amplitude\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ns", "::", "usage"}], "=", "\"\<Spectral index\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Tcmb", "::", "usage"}], "=", "\"\<Temperature of the CMB\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DistanceType", "::", "usage"}], "=", "\"\<Distance type\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Comoving", "::", "usage"}], "=", "\"\<Comoving distance\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TransverseComoving", "::", "usage"}], "=", 
    "\"\<Transeverse comoving distance\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AngularDiameter", "::", "usage"}], "=", 
    "\"\<Angular diameter distance\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Luminosity", "::", "usage"}], "=", 
    "\"\<Luminosity distance\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TransferType", "::", "usage"}], "=", 
    "\"\<Type of transfer function (FitFull etc)\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FitFull", "::", "usage"}], "=", 
    "\"\<Full transfer function from the Eisenstein&Hu1999 fitting function\>\
\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FitBaryon", "::", "usage"}], "=", 
    "\"\<Baryon transfer function from the Eisenstein&Hu1999 fitting function\
\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FitCDM", "::", "usage"}], "=", 
    "\"\<CDM transfer function from the Eisenstein&Hu1999 fitting \
function\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FitNoWiggles", "::", "usage"}], "=", 
    "\"\<'No wiggle' transfer function (wiggles removed, but baryon \
suppression still there) from the Eisenstein&Hu1999 fitting function\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FitZeroBaryon", "::", "usage"}], "=", 
    "\"\<Transfer function in Universe with no baryons from the \
Eisenstein&Hu1999 fitting function\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PSType", "::", "usage"}], "=", 
    "\"\<Specifies the algorithm used to compute the power \
spectrum\>\""}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536239776425123*^9, 3.536239802237091*^9}, {
  3.536239846813039*^9, 3.536240039946976*^9}, {3.536240173475071*^9, 
  3.536240189624159*^9}, {3.550304169726321*^9, 3.5503042343297987`*^9}, {
  3.555149936033284*^9, 3.555149942713242*^9}, {3.555219029480381*^9, 
  3.5552190731085663`*^9}, {3.555219914492313*^9, 3.555219976780637*^9}, {
  3.555220062009549*^9, 3.555220097150422*^9}, {3.555226564413463*^9, 
  3.5552265689276953`*^9}, {3.568098616348275*^9, 3.568098646641757*^9}, {
  3.568099317977598*^9, 3.568099332609397*^9}, {3.5681084909218884`*^9, 
  3.568108491154171*^9}, {3.568108860462729*^9, 3.568108877917962*^9}, {
  3.569750295404313*^9, 3.569750296167598*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Main", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.568030125477455*^9, 3.56803012634937*^9}}],

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536234024615703*^9, 3.536234032958839*^9}, 
   3.536234305470271*^9, 3.53623559668837*^9, 3.536236631858712*^9, 
   3.536236776894196*^9}],

Cell[CellGroupData[{

Cell["Parameters", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.568030117041381*^9, 3.568030119809471*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"zmax", "=", "100"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.555221175200651*^9, 3.555221176873995*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SetCosmology", "[", 
    RowBox[{"o", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "clist", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"clist", "=", 
       RowBox[{"List", "[", "o", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"DownValues", "[", "#", "]"}], "=", 
          RowBox[{"{", 
           RowBox[{"Last", "@", 
            RowBox[{"DownValues", "[", "#", "]"}]}], "}"}]}], ")"}], "&"}], "/@", 
       RowBox[{"{", 
        RowBox[{
        "odesol", ",", " ", "antideriv1", ",", " ", "antideriv2", ",", 
         "transferfitint", ",", "smithPSint", ",", " ", "normalization", ",", 
         "nonlinearint"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Unprotect", "[", "Cosmology", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Cosmology", "[", 
          RowBox[{"[", 
           RowBox[{"First", "@", 
            RowBox[{"First", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"Cosmology", ",", 
               RowBox[{"opt", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}]}], "]"}], "]"}], "=", 
         "opt"}], ",", 
        RowBox[{"{", 
         RowBox[{"opt", ",", "clist"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Protect", "[", "Cosmology", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.555758118803341*^9, 3.5557581391719522`*^9}, {
   3.5558252702848577`*^9, 3.55582537134217*^9}, {3.5558256490865517`*^9, 
   3.555825650723569*^9}, {3.555826293481288*^9, 3.5558263038313293`*^9}, {
   3.55582708024781*^9, 3.555827091606477*^9}, {3.5558273929290047`*^9, 
   3.555827404414213*^9}, {3.5558278429550056`*^9, 3.5558278888285913`*^9}, {
   3.555829985390334*^9, 3.555830020298992*^9}, {3.555830064287052*^9, 
   3.555830066014003*^9}, {3.555830109058154*^9, 3.555830126261627*^9}, {
   3.555830446448277*^9, 3.5558304718535852`*^9}, {3.555830521346319*^9, 
   3.555830548163145*^9}, 3.555830688823525*^9, {3.555830724118353*^9, 
   3.555830744114478*^9}, {3.555830833008627*^9, 3.555830839223407*^9}, {
   3.555830875972705*^9, 3.5558309466676188`*^9}, {3.55583099670716*^9, 
   3.555831241125372*^9}, {3.56803016221211*^9, 3.568030165627966*^9}, {
   3.569669327544249*^9, 3.56966932799876*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Cosmology", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Cosmology", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"OmegaM", "\[Rule]", ".25"}], ",", "\[IndentingNewLine]", 
     RowBox[{"OmegaB", "\[Rule]", ".05"}], ",", "\[IndentingNewLine]", 
     RowBox[{"OmegaC", "\[Rule]", 
      RowBox[{"OmegaM", "-", "OmegaB"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"OmegaL", "\[Rule]", ".75"}], ",", "\[IndentingNewLine]", 
     RowBox[{"OmegaTot", "\[Rule]", 
      RowBox[{"OmegaM", "+", "OmegaL"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"OmegaK", "\[Rule]", 
      RowBox[{"1", "-", "OmegaTot"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"h", "\[Rule]", ".7"}], ",", "\[IndentingNewLine]", 
     RowBox[{"H0", "\[Rule]", 
      RowBox[{"h", " ", "*", 
       RowBox[{"1.", "/", "3000"}]}]}], ",", 
     RowBox[{"(*", 
      RowBox[{"Units", ":", " ", 
       RowBox[{"c", "/", "Mpc"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"omegaM", "\[Rule]", 
      RowBox[{"OmegaM", " ", 
       RowBox[{"h", "^", "2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"omegaL", "\[Rule]", 
      RowBox[{"OmegaL", " ", 
       RowBox[{"h", "^", "2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"omegaB", "\[Rule]", 
      RowBox[{"OmegaB", " ", 
       RowBox[{"h", "^", "2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"omegaC", "\[Rule]", 
      RowBox[{"OmegaC", " ", 
       RowBox[{"h", "^", "2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"omegaK", "\[Rule]", 
      RowBox[{"OmegaK", " ", 
       RowBox[{"h", "^", "2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"w0", "\[Rule]", 
      RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"w1", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
     RowBox[{"gamma", "\[Rule]", ".545"}], ",", 
     RowBox[{"(*", 
      RowBox[{"growth", " ", "index"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"sigma8", "\[Rule]", ".8"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ns", "\[Rule]", ".9"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Tcmb", "\[Rule]", "2.728"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "Cosmology", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cosmoopts", ":=", 
   RowBox[{"Cosmology", "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"DistanceType", "\[Rule]", "\"\<Comoving\>\""}], ",", 
      RowBox[{"PSType", "\[Rule]", "\"\<EH\>\""}], ",", 
      RowBox[{"TransferType", "\[Rule]", "FitFull"}]}], "}"}]}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5306130328644857`*^9, 3.5306131352410088`*^9}, {
   3.530613310258341*^9, 3.530613330093411*^9}, {3.530613433634904*^9, 
   3.530613439362883*^9}, {3.530614760841263*^9, 3.530614768394477*^9}, {
   3.530618061056836*^9, 3.5306181433808002`*^9}, 3.5306186968671207`*^9, {
   3.530858722989628*^9, 3.530858842851224*^9}, {3.530858873571213*^9, 
   3.53085889020722*^9}, {3.530860044328323*^9, 3.5308600558518248`*^9}, {
   3.531132822195998*^9, 3.531132837993095*^9}, {3.53512987159436*^9, 
   3.535129873887273*^9}, {3.535130350365147*^9, 3.535130367098691*^9}, 
   3.535131394439599*^9, {3.535134645801039*^9, 3.535134651859065*^9}, 
   3.535698810681204*^9, 3.53569930178651*^9, {3.535700553178939*^9, 
   3.535700581851538*^9}, 3.535701065958702*^9, {3.535701176736416*^9, 
   3.535701270481396*^9}, {3.535706465929018*^9, 3.535706489116132*^9}, {
   3.535706522723896*^9, 3.535706527966419*^9}, {3.535706743810715*^9, 
   3.535706754811398*^9}, {3.535708042736812*^9, 3.535708048162498*^9}, 
   3.536138498781609*^9, {3.536221490878883*^9, 3.536221501038307*^9}, {
   3.536230420804467*^9, 3.536230583174095*^9}, {3.536230641314381*^9, 
   3.536230738929402*^9}, {3.536232304054985*^9, 3.536232320488431*^9}, {
   3.536232516721249*^9, 3.536232533072122*^9}, {3.536232741487971*^9, 
   3.536232775151576*^9}, 3.536238012428693*^9, 3.536240321583727*^9, {
   3.5551497956770287`*^9, 3.555149800701795*^9}, {3.55514989822711*^9, 
   3.555149898612011*^9}, {3.555219171117092*^9, 3.555219178717018*^9}, {
   3.555220101860361*^9, 3.555220112589397*^9}, {3.555220199720709*^9, 
   3.5552201999777727`*^9}, {3.555827095744022*^9, 3.555827100381341*^9}, {
   3.555836676251445*^9, 3.555836681090519*^9}, {3.5680976813768044`*^9, 
   3.568097682422781*^9}, {3.568098591137533*^9, 3.568098596666596*^9}, {
   3.568099244802652*^9, 3.56809925217731*^9}, {3.568099349226853*^9, 
   3.568099355997305*^9}, {3.569743993584055*^9, 3.569743993691065*^9}, {
   3.569750300736743*^9, 3.569750304434766*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OV", "[", 
    RowBox[{"x_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"OptionValue", "@", "x"}], "/.", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"List", "@", "opts"}], "!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"List", "@", "opts"}], ",", 
        RowBox[{"1", "\[Rule]", "1"}]}], "]"}]}], "//.", "cosmoopts"}], 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OV", "]"}], ":=", "cosmoopts"}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.536225396168883*^9, 3.536225455208419*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Fiducial", "[", 
    RowBox[{"x_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"OV", "[", 
    RowBox[{"x", ",", "opts"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "Fiducial", "]"}], ":=", "cosmoopts"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.53570129336338*^9, 3.535701304404733*^9}, {
   3.535701335352446*^9, 3.535701346803335*^9}, {3.535701771960149*^9, 
   3.535701780157116*^9}, 3.535705608139858*^9, {3.536221359444721*^9, 
   3.536221370894204*^9}, {3.53622305699835*^9, 3.53622306688262*^9}, {
   3.536223132707619*^9, 3.536223155103375*^9}, {3.536223392673865*^9, 
   3.536223406889796*^9}, {3.536223446198094*^9, 3.536223462202458*^9}, {
   3.536223875305522*^9, 3.53622389055727*^9}, {3.536224951534379*^9, 
   3.536224965805771*^9}, {3.536225038596755*^9, 3.536225039937651*^9}, {
   3.536225130082826*^9, 3.536225130740127*^9}, 3.536225161899953*^9, {
   3.536236839081321*^9, 3.536236842776821*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cosmological background functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.568030092120976*^9, 3.568030100357297*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Redshift", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"a", ",", "_Real"}], "}"}], "}"}], ",", 
     RowBox[{
      RowBox[{"1", "/", "a"}], "+", "1"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536235331670743*^9, 3.536235353859804*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"w", "[", 
    RowBox[{"z_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"OV", "[", 
     RowBox[{"w0", ",", "opts"}], "]"}], "+", 
    RowBox[{
     RowBox[{"OV", "[", 
      RowBox[{"w1", ",", "opts"}], "]"}], "*", 
     RowBox[{"z", "/", 
      RowBox[{"(", 
       RowBox[{"1", "+", "z"}], ")"}]}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "w", "]"}], ":=", "cosmoopts"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fw", "[", 
    RowBox[{"z_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], "=", 
   RowBox[{"Integrate", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"w", "[", 
         RowBox[{"z", ",", "opts"}], "]"}]}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{"1", "+", "zx"}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"zx", ",", "0", ",", "z"}], "}"}], ",", 
     RowBox[{"GenerateConditions", "\[Rule]", "False"}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.530611962429327*^9, 3.5306119640113583`*^9}, {
   3.530613354789876*^9, 3.530613398330146*^9}, {3.5306134450903482`*^9, 
   3.5306134967578487`*^9}, {3.530613650190262*^9, 3.530613662917863*^9}, {
   3.530617850693388*^9, 3.530617856202619*^9}, {3.530617937662319*^9, 
   3.53061794478813*^9}, {3.530618036715023*^9, 3.530618040221278*^9}, 
   3.5306182164642277`*^9, {3.5306182697303543`*^9, 3.530618270004027*^9}, {
   3.530618342901495*^9, 3.530618345950347*^9}, {3.5306184514143543`*^9, 
   3.530618454863999*^9}, {3.5306185821663513`*^9, 3.530618655879981*^9}, {
   3.5310356846687717`*^9, 3.531035728349944*^9}, {3.53113286855799*^9, 
   3.5311329197569323`*^9}, {3.531133720850203*^9, 3.5311337289459457`*^9}, {
   3.535128148314988*^9, 3.535128152404346*^9}, {3.535130151276574*^9, 
   3.535130158047239*^9}, {3.535136971075748*^9, 3.535137027044603*^9}, {
   3.53569898778793*^9, 3.535698992181122*^9}, {3.536221289566856*^9, 
   3.536221353645018*^9}, 3.536221459834479*^9, {3.53622546194121*^9, 
   3.536225478236822*^9}, {3.53622619153524*^9, 3.536226216135084*^9}, {
   3.536230757062322*^9, 3.536230762553644*^9}, {3.536232785186037*^9, 
   3.536232876699646*^9}, {3.536233063687329*^9, 3.536233063889862*^9}, {
   3.555309855434536*^9, 3.5553098574877*^9}, 3.555309918540474*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"H", " ", "in", " ", "units", " ", "of", " ", "H_", "0"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DimensionlessHubble", "[", 
      RowBox[{
       RowBox[{"z_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{"Sqrt", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OV", "[", 
         RowBox[{"OmegaM", ",", "opts"}], "]"}], "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", "z"}], ")"}], "^", "3"}]}], "+", 
       RowBox[{
        RowBox[{"OV", "[", 
         RowBox[{"OmegaK", ",", "opts"}], "]"}], "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", "z"}], ")"}], "^", "2"}]}], "+", 
       RowBox[{
        RowBox[{"OV", "[", 
         RowBox[{"OmegaL", ",", "opts"}], "]"}], "*", 
        RowBox[{"Exp", "[", 
         RowBox[{"3", "*", 
          RowBox[{"fw", "[", 
           RowBox[{"z", ",", "opts"}], "]"}]}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "DimensionlessHubble", "]"}], ":=", 
     "cosmoopts"}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.530611962429327*^9, 3.5306119640113583`*^9}, {
   3.530613354789876*^9, 3.530613398330146*^9}, {3.5306134450903482`*^9, 
   3.5306134967578487`*^9}, {3.530613650190262*^9, 3.530613662917863*^9}, {
   3.530617850693388*^9, 3.530617856202619*^9}, {3.530617937662319*^9, 
   3.53061794478813*^9}, {3.530618036715023*^9, 3.530618040221278*^9}, 
   3.5306182164642277`*^9, {3.5306182697303543`*^9, 3.530618270004027*^9}, {
   3.530618342901495*^9, 3.530618345950347*^9}, {3.5306184514143543`*^9, 
   3.530618454863999*^9}, {3.5306185821663513`*^9, 3.530618655879981*^9}, {
   3.5310356846687717`*^9, 3.531035728349944*^9}, {3.53113286855799*^9, 
   3.5311329197569323`*^9}, {3.531133720850203*^9, 3.5311337289459457`*^9}, {
   3.535128148314988*^9, 3.535128152404346*^9}, {3.535130151276574*^9, 
   3.535130158047239*^9}, {3.535136971075748*^9, 3.535137027044603*^9}, {
   3.53569898778793*^9, 3.535698992181122*^9}, {3.536221289566856*^9, 
   3.536221353645018*^9}, 3.536221459834479*^9, {3.53622546194121*^9, 
   3.536225478236822*^9}, {3.53622619153524*^9, 3.536226216135084*^9}, {
   3.536230757062322*^9, 3.536230762553644*^9}, {3.536232785186037*^9, 
   3.536232876699646*^9}, {3.536232966110524*^9, 3.536232974287883*^9}, {
   3.536233027891641*^9, 3.536233030059858*^9}, {3.567936075088003*^9, 
   3.567936076502877*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Hubble", "[", 
    RowBox[{
     RowBox[{"z_", "?", "NumericQ"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"OV", "[", 
     RowBox[{"H0", ",", "opts"}], "]"}], 
    RowBox[{"DimensionlessHubble", "[", 
     RowBox[{"z", ",", "opts"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "Hubble", "]"}], ":=", "cosmoopts"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536232947860058*^9, 3.536233026303678*^9}, 
   3.567936083393033*^9}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"TODO", ":", " ", 
     RowBox[{"Cover", " ", "closed", " ", "Universe"}]}], ";", " ", 
    RowBox[{
     RowBox[{"make", " ", "sure", " ", "a"}], "=", 
     RowBox[{"0", " ", "at", " ", "some", " ", "point"}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"odesol", "[", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"odesol", "[", "opts", "]"}], "=", 
      RowBox[{"Quiet", "@", 
       RowBox[{
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"a", "'"}], "[", "t", "]"}], "/", 
              RowBox[{"a", "[", "t", "]"}]}], "\[Equal]", " ", 
             RowBox[{"Hubble", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "/", 
                 RowBox[{"a", "[", "t", "]"}]}], "-", "1"}], ",", "opts"}], 
              "]"}]}], ",", 
            RowBox[{
             RowBox[{"a", "[", "1", "]"}], "\[Equal]", "1"}]}], "}"}], ",", 
          "a", ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", 
            RowBox[{
             RowBox[{"-", "2"}], "/", 
             RowBox[{"Hubble", "[", 
              RowBox[{"0", ",", "opts"}], "]"}]}], ",", 
            RowBox[{"1", "/", 
             RowBox[{"Hubble", "[", 
              RowBox[{"0", ",", "opts"}], "]"}]}]}], "}"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ScaleFactor", "[", 
      RowBox[{
       RowBox[{"t_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"odesol", "[", "opts", "]"}], "[", "t", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "ScaleFactor", "]"}], ":=", "cosmoopts"}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "odesol", "]"}], ":=", "cosmoopts"}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.555393368260309*^9, 3.555393438529221*^9}, {
   3.555393472131024*^9, 3.5553936347559643`*^9}, 3.5553940817492*^9, {
   3.555394281884922*^9, 3.555394311432963*^9}, {3.5553943624018183`*^9, 
   3.5553943844775887`*^9}, 3.555825295780655*^9, 3.567936091128483*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OmegaM", "[", 
    RowBox[{
     RowBox[{"z_", "?", "NumericQ"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"OV", "[", 
     RowBox[{"OmegaM", ",", "opts"}], "]"}], "*", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "+", "z"}], ")"}], "^", "3"}], "/", 
     RowBox[{
      RowBox[{"DimensionlessHubble", "[", 
       RowBox[{"z", ",", "opts"}], "]"}], "^", "2"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OmegaM", "]"}], ":=", "cosmoopts"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.530611507806348*^9, {3.530613674485734*^9, 3.530613705502389*^9}, {
   3.530613749194336*^9, 3.530613763073786*^9}, {3.530618714399659*^9, 
   3.5306187144883347`*^9}, {3.5306187490423517`*^9, 3.530618749594343*^9}, {
   3.531127225902272*^9, 3.531127234842472*^9}, {3.531132859574224*^9, 
   3.531132890347536*^9}, {3.535136773621787*^9, 3.535136779931805*^9}, {
   3.535136833602602*^9, 3.535136834240516*^9}, {3.536230817534124*^9, 
   3.53623082960167*^9}, 3.53623138888441*^9, {3.5503016892099524`*^9, 
   3.5503016909372063`*^9}, {3.555393416469119*^9, 3.555393418402116*^9}, 
   3.56793609612612*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sinn", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ok", ",", "_Real"}], "}"}]}], "}"}], ",", 
     RowBox[{"Evaluate", "@", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ok", "\[Equal]", "0"}], ",", "x", ",", 
        RowBox[{
         RowBox[{"Sinh", "[", 
          RowBox[{
           RowBox[{"Sqrt", "[", "ok", "]"}], "x"}], "]"}], "/", 
         RowBox[{"Sqrt", "[", "ok", "]"}]}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.530615606219386*^9, 3.53061562233354*^9}, {
   3.530615724526256*^9, 3.5306157395996943`*^9}, {3.53061629065979*^9, 
   3.530616370188772*^9}, {3.530616516034348*^9, 3.5306165243188887`*^9}, {
   3.5306166249327393`*^9, 3.530616654116323*^9}, {3.530616955796636*^9, 
   3.530616987359098*^9}, {3.5306170517535543`*^9, 3.530617056042555*^9}, {
   3.530618714339388*^9, 3.5306187388298187`*^9}, {3.531035736292049*^9, 
   3.5310357446752*^9}, {3.531127967224472*^9, 3.531127969575246*^9}, 
   3.531128023904628*^9, {3.5311285911216373`*^9, 3.53112860120781*^9}, {
   3.531130837629238*^9, 3.531130842642871*^9}, 3.531130974375104*^9, {
   3.5311314315678177`*^9, 3.531131441013884*^9}, 3.531132961615357*^9, {
   3.531205815389617*^9, 3.531205888373618*^9}, {3.5312059230634823`*^9, 
   3.531205996372636*^9}, {3.531206119949469*^9, 3.53120613466961*^9}, {
   3.531206195893633*^9, 3.531206204324704*^9}, {3.53120628627026*^9, 
   3.531206298821224*^9}, {3.5312064040570183`*^9, 3.531206420277615*^9}, {
   3.5312065115336103`*^9, 3.531206520110036*^9}, {3.531206614557189*^9, 
   3.531206625985846*^9}, {3.535131455652387*^9, 3.535131460333546*^9}, {
   3.536225590079373*^9, 3.536225620581762*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"antideriv1", "[", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"antideriv1", "[", "opts", "]"}], "=", 
      RowBox[{
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"y", "'"}], "[", "zx", "]"}], "==", 
            RowBox[{"1", "/", 
             RowBox[{"Hubble", "[", 
              RowBox[{"zx", ",", "opts"}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{"y", "[", "0", "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
         "y", ",", 
         RowBox[{"{", 
          RowBox[{"zx", ",", "0", ",", "zmax"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"antideriv2", "[", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"antideriv2", "[", "opts", "]"}], "=", 
      RowBox[{
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"y", "'"}], "[", "zx", "]"}], "==", 
            RowBox[{
             RowBox[{"1", "/", 
              RowBox[{"Hubble", "[", 
               RowBox[{"zx", ",", "opts"}], "]"}]}], "/", 
             RowBox[{"(", 
              RowBox[{"1", "+", "z"}], ")"}]}]}], ",", 
           RowBox[{
            RowBox[{"y", "[", "0", "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
         "y", ",", 
         RowBox[{"{", 
          RowBox[{"zx", ",", "0", ",", "zmax"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Distance", "[", 
      RowBox[{
       RowBox[{"z_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"OptionValue", "@", "DistanceType"}], ",", 
       "\[IndentingNewLine]", "\"\<Comoving\>\"", ",", 
       RowBox[{
        RowBox[{"antideriv1", "[", "opts", "]"}], "[", "z", "]"}], ",", 
       "\[IndentingNewLine]", "\"\<TransverseComoving\>\"", ",", 
       RowBox[{"sinn", "[", 
        RowBox[{
         RowBox[{"Distance", "[", 
          RowBox[{"z", ",", 
           RowBox[{"DistanceType", "\[Rule]", "Comoving"}], ",", "opts"}], 
          "]"}], ",", 
         RowBox[{"OV", "[", 
          RowBox[{"OmegaK", ",", "opts"}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\"\<AngularDiameter\>\"", ",", 
       RowBox[{
        RowBox[{"Distance", "[", 
         RowBox[{"z", ",", 
          RowBox[{"DistanceType", "\[Rule]", "TransverseComoving"}], ",", 
          "opts"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "+", "z"}], ")"}]}], ",", "\[IndentingNewLine]", 
       "\"\<Luminosity\>\"", ",", 
       RowBox[{
        RowBox[{"Distance", "[", 
         RowBox[{"z", ",", 
          RowBox[{"DistanceType", "\[Rule]", "TransverseComoving"}], ",", 
          "opts"}], "]"}], "*", 
        RowBox[{"(", 
         RowBox[{"1", "+", "z"}], ")"}]}], ",", "\[IndentingNewLine]", 
       "\"\<LookBack\>\"", ",", 
       RowBox[{
        RowBox[{"antideriv2", "[", "opts", "]"}], "[", "z", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Distance", "[", 
      RowBox[{
       RowBox[{"z1_", "?", "NumericQ"}], ",", 
       RowBox[{"z2_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"OptionValue", "@", "DistanceType"}], ",", 
       "\[IndentingNewLine]", "\"\<Comoving\>\"", ",", 
       RowBox[{
        RowBox[{"Distance", "[", 
         RowBox[{"z2", ",", "opts"}], "]"}], "-", 
        RowBox[{"Distance", "[", 
         RowBox[{"z1", ",", "opts"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "\"\<TransverseComoving\>\"", ",", "Null", ",", "\[IndentingNewLine]", 
       "\"\<AngularDiameter\>\"", ",", "Null", ",", "\[IndentingNewLine]", 
       "\"\<Luminosity\>\"", ",", "Null", ",", 
       RowBox[{"(*", "TODO", "*)"}], "\[IndentingNewLine]", 
       "\"\<LookBack\>\"", ",", 
       RowBox[{
        RowBox[{"Distance", "[", 
         RowBox[{"z2", ",", "opts"}], "]"}], "-", 
        RowBox[{"Distance", "[", 
         RowBox[{"z1", ",", "opts"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "Distance", "]"}], ":=", "cosmoopts"}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.535129897348506*^9, 3.535130138069021*^9}, {
   3.535130175381719*^9, 3.535130184859015*^9}, {3.535130284504922*^9, 
   3.535130285297915*^9}, {3.535130316806978*^9, 3.535130346951308*^9}, {
   3.535130396801585*^9, 3.535130417329156*^9}, {3.535130960926051*^9, 
   3.535130973996482*^9}, {3.535131008006137*^9, 3.5351310600986*^9}, {
   3.535131260775752*^9, 3.535131315810659*^9}, {3.535131472741124*^9, 
   3.535131485061628*^9}, {3.535134658942524*^9, 3.535134670624739*^9}, 
   3.535698806291387*^9, {3.53622959805045*^9, 3.536229614177892*^9}, {
   3.536229677021655*^9, 3.536229849893553*^9}, {3.536229883336474*^9, 
   3.536229898518673*^9}, {3.536230096721121*^9, 3.536230108619347*^9}, {
   3.536230780195892*^9, 3.536230809515236*^9}, {3.536230928888952*^9, 
   3.536230933324525*^9}, 3.536231397418547*^9, {3.536238332829496*^9, 
   3.536238335967587*^9}, {3.555221182803648*^9, 3.555221185237687*^9}, {
   3.5552358817462463`*^9, 3.555235882450485*^9}, {3.555393622363084*^9, 
   3.555393624567133*^9}, 3.555825303886839*^9, {3.555829317094297*^9, 
   3.555829318182152*^9}, {3.567936098129641*^9, 3.5679361006115847`*^9}, {
   3.568097643092503*^9, 3.5680976636310053`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"growth", " ", "factor"}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrowthFactor", "[", 
      RowBox[{
       RowBox[{"z_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"OmegaM", "[", 
       RowBox[{"z", ",", "opts"}], "]"}], "^", 
      RowBox[{"OV", "[", 
       RowBox[{"gamma", ",", "opts"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "GrowthFactor", "]"}], ":=", "cosmoopts"}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"antideriv3", "[", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"antideriv3", "[", "opts", "]"}], "=", 
      RowBox[{
       RowBox[{"NDSolve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"y", "'"}], "[", "zx", "]"}], "\[Equal]", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"GrowthFactor", "[", 
               RowBox[{"zx", ",", "opts"}], "]"}]}], "/", 
             RowBox[{"(", 
              RowBox[{"1", "+", "zx"}], ")"}]}]}], ",", 
           RowBox[{
            RowBox[{"y", "[", "0", "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
         "y", ",", 
         RowBox[{"{", 
          RowBox[{"zx", ",", "0", ",", "zmax"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "antideriv3", "]"}], ":=", "cosmoopts"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GrowthFunction", "[", 
      RowBox[{
       RowBox[{"z_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"antideriv3", "[", "opts", "]"}], "[", "z", "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "GrowthFunction", "]"}], ":=", "cosmoopts"}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.530609992719887*^9, 3.5306100077788477`*^9}, {
   3.5306101420708523`*^9, 3.530610149334343*^9}, {3.530610210746345*^9, 
   3.530610220714847*^9}, {3.53061150097472*^9, 3.5306115031991453`*^9}, 
   3.5306136788108873`*^9, {3.530613709888793*^9, 3.530613734737277*^9}, {
   3.530613771138349*^9, 3.530613778553999*^9}, 3.530618714528369*^9, {
   3.530618751242433*^9, 3.530618751802393*^9}, {3.53061881849835*^9, 
   3.5306188306399813`*^9}, {3.530869033968048*^9, 3.5308690348277693`*^9}, {
   3.530872767603218*^9, 3.530872797671803*^9}, {3.531035759098538*^9, 
   3.531035767530158*^9}, {3.531127042160928*^9, 3.531127076403586*^9}, {
   3.531127165304305*^9, 3.5311272010670843`*^9}, {3.5311339213348637`*^9, 
   3.5311339242211037`*^9}, 3.5312031414338627`*^9, {3.531207102949616*^9, 
   3.531207111271228*^9}, 3.531211659345348*^9, {3.535136838968219*^9, 
   3.535136916424915*^9}, 3.536231401938932*^9, {3.536233133975984*^9, 
   3.536233152137924*^9}, {3.536233194005997*^9, 3.536233294324486*^9}, 
   3.536234106529137*^9, {3.5551496399229918`*^9, 3.55514964346091*^9}, {
   3.555152042418437*^9, 3.555152044851372*^9}, {3.55515214472304*^9, 
   3.55515214552746*^9}, {3.5552211939410887`*^9, 3.555221194315918*^9}, 
   3.5552323746157846`*^9, {3.555232689805072*^9, 3.555232692283399*^9}, 
   3.555319290072953*^9, 3.5558253118688602`*^9, {3.567936104066984*^9, 
   3.5679361062507763`*^9}, {3.569744041039496*^9, 3.569744046074027*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Power Spectrum", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.568030077897833*^9, 3.5680300814889393`*^9}}],

Cell[CellGroupData[{

Cell["Eisenstein&Hu", "Subsubsection",
 CellChangeTimes->{{3.569655708043653*^9, 3.5696557120830793`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Transfer", " ", "function"}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"transferfitint", "[", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", " ", 
     RowBox[{
      RowBox[{"transferfitint", "[", "opts", "]"}], "=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"result", ",", "link", ",", "fitonek"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"link", "=", 
          RowBox[{"Install", "[", 
           RowBox[{"$location", "<>", "\"\</tf_fit_link\>\""}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Global`TFSetParameters", "[", 
          RowBox[{
           RowBox[{"OV", "[", 
            RowBox[{"omegaM", ",", "opts"}], "]"}], ",", 
           RowBox[{
            RowBox[{"OV", "[", 
             RowBox[{"OmegaB", ",", "opts"}], "]"}], "/", 
            RowBox[{"OV", "[", 
             RowBox[{"OmegaC", ",", "opts"}], "]"}]}], ",", 
           RowBox[{"OV", "[", 
            RowBox[{"Tcmb", ",", "opts"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"fitonek", "[", "k_", "]"}], ":=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Global`TFFitOneK", "[", "k", "]"}], ",", 
            RowBox[{"LinkRead", "[", "link", "]"}], ",", 
            RowBox[{"LinkRead", "[", "link", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Global`TFNoWiggles", "[", 
             RowBox[{
              RowBox[{"OV", "[", 
               RowBox[{"OmegaC", ",", "opts"}], "]"}], ",", 
              RowBox[{
               RowBox[{"OV", "[", 
                RowBox[{"OmegaB", ",", "opts"}], "]"}], "/", 
               RowBox[{"OV", "[", 
                RowBox[{"OmegaC", ",", "opts"}], "]"}]}], ",", 
              RowBox[{"OV", "[", 
               RowBox[{"h", ",", "opts"}], "]"}], ",", 
              RowBox[{"OV", "[", 
               RowBox[{"Tcmb", ",", "opts"}], "]"}], ",", 
              RowBox[{"k", "/", 
               RowBox[{"OV", "[", 
                RowBox[{"h", ",", "opts"}], "]"}]}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Global`TFZeroBaryon", "[", 
             RowBox[{
              RowBox[{"OV", "[", 
               RowBox[{"OmegaC", ",", "opts"}], "]"}], ",", 
              RowBox[{"OV", "[", 
               RowBox[{"h", ",", "opts"}], "]"}], ",", 
              RowBox[{"OV", "[", 
               RowBox[{"Tcmb", ",", "opts"}], "]"}], ",", 
              RowBox[{"k", "/", 
               RowBox[{"OV", "[", 
                RowBox[{"h", ",", "opts"}], "]"}]}]}], "]"}]}], "}"}]}], ";", 
         " ", "\[IndentingNewLine]", 
         RowBox[{"result", "=", 
          RowBox[{"Interpolation", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"10", "^", "lk"}], ",", 
               RowBox[{"fitonek", "[", 
                RowBox[{"10", "^", "lk"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"lk", ",", 
               RowBox[{"-", "6"}], ",", "4", ",", ".01"}], "}"}]}], "]"}]}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"Uninstall", "[", "link", "]"}], ";", "\[IndentingNewLine]", 
         "result"}]}], "\[IndentingNewLine]", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TransferFunction", "[", 
      RowBox[{
       RowBox[{"k_", "?", "NumericQ"}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"transferfitint", "[", "opts", "]"}], "[", "k", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OV", "[", 
          RowBox[{"TransferType", ",", "opts"}], "]"}], ",", "FitFull", ",", 
         "1", ",", "FitBaryon", ",", "2", ",", "FitCDM", ",", "3", ",", 
         "FitNoWiggles", ",", "4", ",", "FitZeroBaryon", ",", "5"}], "]"}], 
       "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "transferfitint", "]"}], ":=", "cosmoopts"}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "TransferFunction", "]"}], ":=", "cosmoopts"}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.555147879663821*^9, 3.555147894224782*^9}, {
   3.555148736644782*^9, 3.5551487449988127`*^9}, {3.5551489343877487`*^9, 
   3.555148935090983*^9}, {3.555148974523848*^9, 3.555149024153892*^9}, {
   3.5551490561144533`*^9, 3.5551491118290777`*^9}, {3.555149531902954*^9, 
   3.555149537045389*^9}, {3.555149595488145*^9, 3.555149626317671*^9}, {
   3.555149673219554*^9, 3.555149784088876*^9}, {3.555150009463418*^9, 
   3.5551501083557*^9}, {3.555150158869966*^9, 3.5551503005877457`*^9}, {
   3.555150664183648*^9, 3.555150676659886*^9}, {3.5551514525824842`*^9, 
   3.5551514686235228`*^9}, {3.5551534664114723`*^9, 3.555153567415206*^9}, {
   3.555153655230048*^9, 3.555153657327985*^9}, 3.555153705204108*^9, {
   3.555153776588608*^9, 3.555153865333705*^9}, {3.55515394724113*^9, 
   3.555153956329297*^9}, {3.5551540425663652`*^9, 3.555154082881078*^9}, 
   3.555154229773356*^9, {3.555218720982142*^9, 3.555218790274418*^9}, {
   3.555218821678852*^9, 3.555218849481203*^9}, {3.555218889549622*^9, 
   3.555218945688233*^9}, {3.5552191559581633`*^9, 3.555219162605247*^9}, {
   3.5552201423546963`*^9, 3.5552201524744*^9}, {3.555222752373712*^9, 
   3.555222786639133*^9}, 3.555233391349909*^9, {3.555234757249782*^9, 
   3.555234761133334*^9}, {3.555234867638899*^9, 3.555234867879015*^9}, {
   3.555236619285472*^9, 3.555236629142144*^9}, {3.5557374497824163`*^9, 
   3.555737459928608*^9}, {3.555738335097858*^9, 3.555738338303249*^9}, {
   3.555739101537229*^9, 3.5557391037392807`*^9}, 3.55582532106707*^9, 
   3.555840041203693*^9, {3.568099413585108*^9, 3.5680994212345657`*^9}, {
   3.5681084824238987`*^9, 3.5681084839937677`*^9}, 3.568108899395213*^9, {
   3.568109666342104*^9, 3.568109667392048*^9}, {3.569750537158009*^9, 
   3.5697505453547277`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"linear", " ", "ps"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"See", " ", "Amendola"}], "&"}], "Tsujikawa", " ", "4.212"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"LinearPS", "[", 
      RowBox[{"k_", ",", "z_", ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"TransferFunction", "[", 
        RowBox[{"k", ",", "opts"}], "]"}], "^", "2"}], " ", "*", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"k", "/", 
         RowBox[{"OV", "[", 
          RowBox[{"H0", ",", "opts"}], "]"}]}], ")"}], "^", 
       RowBox[{"OV", "[", 
        RowBox[{"ns", ",", "opts"}], "]"}]}], "*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"GrowthFunction", "[", 
         RowBox[{"z", ",", "opts"}], "]"}], "^", "2"}], "/", 
       RowBox[{
        RowBox[{"OV", "[", 
         RowBox[{"H0", ",", "opts"}], "]"}], "^", "3"}]}], "*", "2", " ", 
      RowBox[{"Pi", "^", "2"}], "*", 
      RowBox[{"(", "3.2*^-10", ")"}]}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tophatFT", "[", "x_", "]"}], ":=", 
     RowBox[{
      RowBox[{"3", "/", 
       RowBox[{"x", "^", "3"}]}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sin", "[", "x", "]"}], "-", 
        RowBox[{"x", " ", 
         RowBox[{"Cos", "[", "x", "]"}]}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"normalization", "[", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"normalization", "[", "opts", "]"}], "=", 
      RowBox[{
       RowBox[{"OV", "[", 
        RowBox[{"sigma8", ",", "opts"}], "]"}], "/", 
       RowBox[{"Sqrt", "@", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Exp", "[", 
             RowBox[{"3", " ", "lk"}], "]"}], "/", 
            RowBox[{"(", 
             RowBox[{"2", 
              RowBox[{"Pi", "^", "2"}]}], ")"}]}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"TransferFunction", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Exp", "[", "lk", "]"}], "*", 
                 RowBox[{"OV", "[", 
                  RowBox[{"h", ",", "opts"}], "]"}]}], ",", "opts"}], "]"}], 
              "^", "2"}], " ", "*", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"lk", "*", 
               RowBox[{"OV", "[", 
                RowBox[{"ns", ",", "opts"}], "]"}]}], "]"}]}], ")"}], 
           RowBox[{
            RowBox[{"tophatFT", "[", 
             RowBox[{"8", 
              RowBox[{"Exp", "[", "lk", "]"}]}], "]"}], "^", "2"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"lk", ",", 
            RowBox[{"Log", "[", 
             RowBox[{"10", "^", 
              RowBox[{"-", "6"}]}], "]"}], ",", 
            RowBox[{"Log", "[", 
             RowBox[{"10", "^", "4"}], "]"}]}], "}"}], ",", 
          RowBox[{"PrecisionGoal", "\[Rule]", "5"}]}], "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"LinearPS", "[", 
      RowBox[{"k_", ",", "z_", ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"TransferFunction", "[", 
        RowBox[{
         RowBox[{"k", "*", 
          RowBox[{"OV", "[", 
           RowBox[{"h", ",", "opts"}], "]"}]}], ",", "opts"}], "]"}], "^", 
       "2"}], " ", "*", " ", 
      RowBox[{"k", "^", 
       RowBox[{"OV", "[", 
        RowBox[{"ns", ",", "opts"}], "]"}]}], "*", " ", 
      RowBox[{
       RowBox[{"GrowthFunction", "[", 
        RowBox[{"z", ",", "opts"}], "]"}], "^", "2"}], "*", 
      RowBox[{
       RowBox[{"normalization", "[", "opts", "]"}], "^", "2"}]}]}], ";", 
    RowBox[{
     RowBox[{"Options", "[", "LinearPS", "]"}], ":=", "cosmoopts"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "normalization", "]"}], ":=", "cosmoopts"}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.555151217002199*^9, 3.55515122122469*^9}, {
   3.5551513194277887`*^9, 3.555151336571067*^9}, {3.5551514942173986`*^9, 
   3.555151561795163*^9}, {3.555152230623705*^9, 3.5551522380725517`*^9}, 
   3.555152627404873*^9, 3.55521879102337*^9, {3.55522013813684*^9, 
   3.555220139599905*^9}, 3.555220411262555*^9, 3.555222733179741*^9, {
   3.555222766530266*^9, 3.5552227877866783`*^9}, {3.555233501284321*^9, 
   3.555233550039926*^9}, {3.5552336803160753`*^9, 3.555233683270043*^9}, {
   3.5552400500814667`*^9, 3.5552400572830276`*^9}, 3.5553193296446533`*^9, {
   3.555319860035037*^9, 3.555319937303084*^9}, {3.555320483254998*^9, 
   3.555320485634103*^9}, 3.5553205253226357`*^9, 3.555321980832925*^9, {
   3.555324835549293*^9, 3.555324835667225*^9}, {3.555327294185296*^9, 
   3.55532732296091*^9}, {3.5553945049812937`*^9, 3.5553945075915947`*^9}, {
   3.5553946290122643`*^9, 3.5553946316909437`*^9}, 3.555671933129588*^9, {
   3.5557384263925447`*^9, 3.555738611477201*^9}, {3.555738644861454*^9, 
   3.555738773523287*^9}, {3.555738811263177*^9, 3.5557388166855307`*^9}, 
   3.5557389349472523`*^9, {3.555739340097102*^9, 3.555739363949169*^9}, 
   3.555739419565542*^9, {3.555739744693315*^9, 3.5557397552140427`*^9}, 
   3.55574273186559*^9, 3.555825332156158*^9, {3.5558403387982407`*^9, 
   3.555840341737035*^9}, 3.5558404226976433`*^9, 3.557745242568014*^9}]
}, Open  ]],

Cell["Smith Halofit", "Subsubsection",
 CellChangeTimes->{{3.569655721135118*^9, 3.569655724682918*^9}}],

Cell[CellGroupData[{

Cell["Unification of the above", "Subsubsection",
 CellChangeTimes->{{3.569655739975047*^9, 3.5696557485669117`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Umberella", " ", "function", " ", "for", " ", "the", " ", "power", " ", 
    "spectrum"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PowerSpectrum", "[", 
      RowBox[{"k_", ",", "z_", ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"OV", "[", 
          RowBox[{"PSType", ",", "opts"}], "]"}], ",", "\"\<HaloFit0\>\"", 
         ",", 
         RowBox[{"SmithPS", "[", 
          RowBox[{"k", ",", "z", ",", "0", ",", "opts"}], "]"}], ",", 
         "\"\<HaloFit1\>\"", ",", 
         RowBox[{"SmithPS", "[", 
          RowBox[{"k", ",", "z", ",", "1", ",", "opts"}], "]"}], ",", 
         "\"\<HaloFit2\>\"", ",", 
         RowBox[{"SmithPS", "[", 
          RowBox[{"k", ",", "z", ",", "2", ",", "opts"}], "]"}], ",", 
         "\"\<EH\>\"", ",", 
         RowBox[{"LinearPS", "[", 
          RowBox[{"k", ",", "z", ",", "opts"}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "PowerSpectrum", "]"}], ":=", "cosmoopts"}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.568032540663191*^9, 3.5680326144440727`*^9}, {
  3.568095673102022*^9, 3.5680956866855907`*^9}, {3.568096242924265*^9, 
  3.56809627121343*^9}, {3.568096683212821*^9, 3.568096703661015*^9}, {
  3.5680971410333147`*^9, 3.568097149223648*^9}, {3.568097195700774*^9, 
  3.568097223383381*^9}, {3.568097600770227*^9, 3.5680976197700787`*^9}, {
  3.568099224133854*^9, 3.568099224626792*^9}, {3.5696556828632603`*^9, 
  3.569655694258316*^9}, {3.569658872374748*^9, 3.5696588728867598`*^9}, {
  3.569668349106762*^9, 3.5696684001912613`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["TRG", "Subsubsection",
 CellChangeTimes->{{3.56965573100708*^9, 3.5696557313350058`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{"$location", "<>", "\"\<psnonlinear.m\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<NumericalCalculus`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nonlinearint", "[", 
    RowBox[{"Omega21_", ",", "Omega22_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"nonlinearint", "[", 
     RowBox[{"Omega21", ",", "Omega22", ",", "opts"}], "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"pstable", ",", "klist", ",", "result", ",", "zz"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pstable", "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"k", ",", 
             RowBox[{"PowerSpectrum", "[", 
              RowBox[{"k", ",", "0", ",", "opts"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", 
             RowBox[{"10", "^", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"-", "4"}], ",", "3", ",", ".01"}], "]"}]}]}], 
            "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"result", "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"TRGPowerSpectrum", "[", 
          RowBox[{"pstable", ",", "35", ",", "0", ",", 
           RowBox[{"Abs", "@", 
            RowBox[{"ND", "[", 
             RowBox[{
              RowBox[{"Log", "[", 
               RowBox[{"GrowthFunction", "[", 
                RowBox[{"zz", ",", "opts"}], "]"}], "]"}], ",", "zz", ",", 
              "35"}], "]"}]}], ",", 
           RowBox[{"OV", "[", 
            RowBox[{"H0", ",", "opts"}], "]"}], ",", 
           RowBox[{"OV", "[", 
            RowBox[{"ns", ",", "opts"}], "]"}], ",", "Omega21", ",", 
           "Omega22"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"result", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NonlinearPowerSpectrum", "[", 
    RowBox[{"k_", ",", "Omega21_", ",", "Omega22_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"nonlinearint", "[", 
     RowBox[{"Omega21", ",", "Omega22", ",", "opts"}], "]"}], "[", "k", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "nonlinearint", "]"}], ":=", "cosmoopts"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "NonlinearPowerSpectrum", "]"}], ":=", 
   "cosmoopts"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQveytcePUGa8ctxRMaQbRId13Z80E0hOycueCaNGr
nnKzgPS/qngwzavZ7gCiFZsF3UH0ee87XSA6YEvvJBBtsaF9OojO3DF/Boie
5Nw0D0S7cAguBtERKTqXQfT+j+mPQHTGT2aHPUCafdo0FxCdtoe9B0SreZ6b
DKJfRfK9AtG/hV3BdPBU3Zl7gbR/eiyYttDjugqi559eB6b9rv0z3wekPxhs
sgDRWvxuL0C0Sl89mF51KodzP5B+/6QUTBslvXMG0Rx1m9xBdM46n2AQbbCR
MwREO7zbGQGiPzR7RYJokS+T7h4E0tP0DoNpAGdZsI0=
  "]],

Cell[BoxData[{
 RowBox[{"End", "[", " ", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", " ", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.536234041422625*^9, 3.536234050194671*^9}, {
  3.536235605195163*^9, 3.536235605993851*^9}, {3.536236869079903*^9, 
  3.536236870382352*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1680, 985},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
CellContext->Notebook,
FrontEndVersion->"8.0 for Linux x86 (64-bit) (October 10, 2011)",
StyleDefinitions->FrontEnd`FileName[{"Creative"}, "NaturalColor.nb", 
  CharacterEncoding -> "UTF-8"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 120, 2, 96, "Section",
 InitializationCell->True],
Cell[702, 26, 272, 5, 49, "Input",
 InitializationCell->True],
Cell[977, 33, 221, 5, 49, "Input",
 InitializationCell->True],
Cell[1201, 40, 362, 7, 49, "Input",
 InitializationCell->True],
Cell[1566, 49, 269, 6, 49, "Input",
 InitializationCell->True],
Cell[1838, 57, 269, 7, 49, "Input",
 InitializationCell->True],
Cell[2110, 66, 296, 7, 49, "Input",
 InitializationCell->True],
Cell[2409, 75, 345, 8, 49, "Input",
 InitializationCell->True],
Cell[2757, 85, 234, 5, 49, "Input",
 InitializationCell->True],
Cell[2994, 92, 358, 7, 49, "Input",
 InitializationCell->True],
Cell[3355, 101, 334, 7, 49, "Input",
 InitializationCell->True],
Cell[3692, 110, 316, 7, 49, "Input",
 InitializationCell->True],
Cell[4011, 119, 310, 7, 49, "Input",
 InitializationCell->True],
Cell[4324, 128, 271, 7, 49, "Input",
 InitializationCell->True],
Cell[4598, 137, 463, 9, 96, "Input",
 InitializationCell->True],
Cell[5064, 148, 820, 13, 119, "Input",
 InitializationCell->True],
Cell[5887, 163, 602, 10, 96, "Input",
 InitializationCell->True],
Cell[6492, 175, 314, 6, 49, "Input",
 InitializationCell->True],
Cell[6809, 183, 440, 8, 96, "Input",
 InitializationCell->True],
Cell[7252, 193, 4825, 112, 763, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[12114, 310, 115, 2, 96, "Section",
 InitializationCell->True],
Cell[12232, 314, 262, 5, 49, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[12519, 323, 125, 2, 42, "Subsection",
 InitializationCell->True],
Cell[12647, 327, 165, 4, 49, "Input",
 InitializationCell->True],
Cell[12815, 333, 2614, 58, 188, "Input",
 InitializationCell->True],
Cell[15432, 393, 4637, 88, 533, "Input",
 InitializationCell->True],
Cell[20072, 483, 763, 24, 73, "Input",
 InitializationCell->True],
Cell[20838, 509, 1102, 23, 73, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[21977, 537, 148, 2, 42, "Subsection",
 InitializationCell->True],
Cell[22128, 541, 365, 11, 76, "Input",
 InitializationCell->True],
Cell[22496, 554, 2496, 57, 150, "Input",
 InitializationCell->True],
Cell[24995, 613, 2627, 58, 185, "Input",
 InitializationCell->True],
Cell[27625, 673, 628, 19, 113, "Input",
 InitializationCell->True],
Cell[28256, 694, 2587, 72, 293, "Input",
 InitializationCell->True],
Cell[30846, 768, 1316, 33, 113, "Input",
 InitializationCell->True],
Cell[32165, 803, 1871, 38, 76, "Input",
 InitializationCell->True],
Cell[34039, 843, 6096, 149, 652, "Input",
 InitializationCell->True],
Cell[40138, 994, 3807, 91, 328, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[43982, 1090, 131, 2, 31, "Subsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[44138, 1096, 106, 1, 35, "Subsubsection"],
Cell[44247, 1099, 6308, 139, 395, "Input",
 InitializationCell->True],
Cell[50558, 1240, 5731, 145, 326, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[56304, 1388, 104, 1, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[56433, 1393, 117, 1, 26, "Subsubsection"],
Cell[56553, 1396, 1946, 45, 165, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[58536, 1446, 95, 1, 35, "Subsubsection"],
Cell[58634, 1449, 3348, 87, 257, "Input",
 InitializationCell->True],
Cell[61985, 1538, 313, 6, 73, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
